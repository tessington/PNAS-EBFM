# Last Modified on February 27 2017
# Extract output files (generated by M file "Data Extraction for Figures.M").  Make
# plot of each harvest pathway for each CASE and FLAg

rm(list = ls())

require(viridis)
wd <- '/Users/essing/Dropbox/Desktop/Rcode/EggPredationModel'
setwd(wd)

# Determine which output to plot.  1 = base, 2-4 are sensitivity runs
output.2.plot <- 1

datadirs <- c('data/optimization_output_summer_2016','data/Sensitivity_Diets',
              'data/Sensitivity_Discount',
              'data/Sensitivity_Prices')

datadir <- datadirs[output.2.plot]

plotfilenames <- c("biomass.pathways.pdf",
                   "biomass.pathways.sensitivity.diets.pdf",
                   "biomass.pathways.sensitivity.discount.pdf",
                   "biomass.pathways.sensitivity.prices.pdf"  )
plotfilename <- plotfilenames[output.2.plot]

# Set up plotting parameters
setwd("./graphics")
pdf(file = plotfilename,
    height = 6,
    width = 8)
setwd(wd)

par(
  omi = c(.5, .75, .5, .5),
  mai = c(.5, .2, 0.25, 0.0),
  las = 1,
  mfcol = c(2, 4),
  cex.lab = 1.5,
  cex.axis = 1.25
)

col <- viridis(n=16)[c(2,6,10,16)]
#colorRampPalette(viridis, interpolate = "spline")(8)[c(2, 6, 7, 8)]


case.list <-
  c(
    "A. High Piscivore \nHigh Prey",
    "B. High Piscivore \nLow Prey",
    "C. Low Piscivore \nHigh Prey",
    "D. Low Piscivore \nLow Prey"
  )

setwd(paste("./",datadir,sep = ""))

for (CASE in 1:4) {
  codB = c()
  codF = c()
  herrB = c()
  herrF = c()
  
  for (FLAG in 1:4) {
    filename <- paste('output_', CASE, '_', FLAG, '.csv', sep = "")
    tmp.data <- read.csv(file = filename)
    eval(parse(
      text = paste(
        'data',
        CASE,
        FLAG,
        '<-tmp.data',
        sep = ""
      )
    ))
    if (FLAG == 1)
      eval(parse(text = paste('time<-data', CASE, FLAG, '[,1]', sep = "")))
    eval(parse(
      text = paste('codB<-cbind(codB,data', CASE, FLAG, '[,2])', sep = "")
    ))
    eval(parse(
      text = paste('codF<-cbind(codF,data', CASE, FLAG, '[,4])', sep = "")
    ))
    eval(parse(
      text = paste('herrB<-cbind(herrB,data', CASE, FLAG, '[,3])', sep = "")
    ))
    eval(parse(
      text = paste('herrF<-cbind(herrF,data', CASE, FLAG, '[,5])', sep = "")
    ))
  }
  
  
  
  xlim <- c(0, 15)
  ylimC <- c(0, 2.75)
  ylimH <- c(0,10)
  if (CASE == 1) {
    plot(
      time,
      codB[, 1],
      type = "l",
      lwd = 2,
      xaxs = "i",
      yaxs = 'i',
      col = col[1],
      ylim = ylimC,
      xlim = xlim,
      ylab = "Piscivore Biomass",
      xlab = "",
      axes = F,
      main = case.list[CASE]
    )
    axis(1, at = xlim)
    axis(2, at = ylimC)
    mtext(
      side = 2,
      text = "Piscivore Biomass",
      line = 3,
      las = 0
    )
  } else {
    plot(
      time,
      codB[, 1],
      type = "l",
      lwd = 2,
      xaxs = "i",
      yaxs = 'i',
      col = col[1],
      ylim = ylimC,
      xlim = xlim,
      xlab = "",
      ylab = "",
      axes = F,
      main = case.list[CASE]
    )
    axis(1, at = xlim)
    axis(2, at = ylimC, labels = c("", ""))
  }
  
  for (i in 2:4) {
    lines(time, codB[, i], lwd = 2, col = col[i])
  }
  # Plot herring
  
  if (CASE == 1) {
    plot(
      time,
      herrB[, 1],
      type = "l",
      lwd = 2,
      xaxs = "i",
      yaxs = 'i',
      col = col[1],
      ylim = ylimH,
      xlim = xlim,
      ylab = "Prey Biomass",
      xlab = "",
      axes = F
    )
    axis(1, at = xlim)
    axis(2, at = ylimH)
    mtext(
      side = 2,
      text = "Prey Biomass",
      line = 3,
      las = 0
    )
  } else {
    plot(
      time,
      herrB[, 1],
      type = "l",
      lwd = 2,
      xaxs = "i",
      yaxs = 'i',
      col = col[1],
      ylim = ylimH,
      xlim = xlim,
      xlab = "",
      ylab = "",
      axes = F
    )
    axis(1, at = xlim)
    axis(2, at = ylimH, labels = c("", ""))
  }
  for (i in 2:4) {
    lines(time, herrB[, i], lwd = 2, col = col[i])
  }
  # create legend
}
if (output.2.plot %in% c(1,4)) legend(
  'topright',
  legend = c('Independent', '+Predation', '+Egg Predation', '+ Depensation'),
  col = col,
  lwd = 2,
  cex=1.25,
  bty = "n"
)
setwd(wd)
dev.off()
setwd("./graphics")
# otpional code to open using Skim
system2("open", args = c("-a Skim.app", plotfilename))
setwd(wd)