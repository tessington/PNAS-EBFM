# Last Modified on February 27 2017
# Extract output files (generated by M file "Data Extraction for Figures.M").  Make
# plot of each harvest pathway for each CASE (starting conditions)
# and and FLAG (ecological scenario)

rm(list = ls())


require(viridis)
wd <- '/Users/essing/Dropbox/Desktop/Rcode/EggPredationModel'
setwd(wd)


#datadir <- 'data/optimization_output_summer_2016'
datadirs <- c('data/Sensitivity_Diets', 'data/Sensitivity_Discount07', 'data/Sensitivity_Prices')

plotfilename <- "harvest.pathways.sensitivity.pdf"
layout.mat <- matrix(c(1,3,5,7,
                       1,3,5,7,
                       1,3,5,7,
                        2,4,6,8,
                       2,4,6,8,
                       2,4,6,8,
                        25,25,25,25,
                        9,11,13,15,
                       9,11,13,15,
                       9,11,13,15,
                       10,12,14,16,
                       10,12,14,16,
                       10,12,14,16,
                       25,25,25,25,
                        17,19,21,23,
                       17,19,21,23,
                       17,19,21,23,
                        18,20,22,24,
                       18,20,22,24,
                       18,20,22,24),
                      nrow = 20,
                      ncol = 4,
                     byrow = T)

# Set up plotting parameters
setwd("./graphics")
pdf(file = plotfilename,
    height = 11,
    width = 8.5)
setwd(wd)
layout(layout.mat)
par(
  omi = c(1, 1, 1, 1),
  mai = c(.05, .1, 0.26, 0.1),
  las = 1,
  cex.lab = 1.5,
  cex.axis = 1.0
)

col <- viridis(n=16)[c(2,6,10,16)]

case.list <-
  c(
    "High Piscivore \nHigh Prey",
    "High Piscivore \nLow Prey",
    "Low Piscivore \nHigh Prey",
    "Low Piscivore \nLow Prey"
  )

for (SENS in 1:3) {
  datadir <- datadirs[SENS]
  setwd(paste("./",datadir,sep = ""))
for (CASE in 1:4) {
  codB = c()
  codF = c()
  herrB = c()
  herrF = c()
  
  for (FLAG in 1:4) {
    filename <- paste('output_', CASE, '_', FLAG, '.csv', sep = "")
    
    tmp.data <- read.csv(file = filename)
    eval(parse(
      text = paste(
        'data',
        CASE,
        FLAG,
        '<-tmp.data',
        sep = ""
      )
    ))
    if (FLAG == 1)
      eval(parse(text = paste('time<-data', CASE, FLAG, '[,1]', sep = "")))
    eval(parse(
      text = paste('codF<-cbind(codF,data', CASE, FLAG, '[,4])', sep = "")
    ))
    eval(parse(
      text = paste('herrF<-cbind(herrF,data', CASE, FLAG, '[,5])', sep = "")
    ))
  }
  
  
  
  xlim <- c(0, 15)
  ylim <- c(0, .5)
  case.2.use <- rep("",4)
  if (SENS == 1) case.2.use <- case.list
  if (CASE == 1) {
    plot(
      time,
      codF[, 1],
      type = "l",
      lwd = 2,
      xaxs = "i",
      yaxs = 'i',
      col = col[1],
      ylim = ylim,
      xlim = xlim,
      ylab = "Piscivore \nFishing Rate",
      xlab = "",
      axes = F,
      main = case.2.use[CASE]
    )
    axis(1, at = xlim)
    axis(2, at = ylim)
    mtext(
      side = 2,
      text = "Piscivore \nFishing Rate",
      line = 3,
      las = 0
    )
  } else {
    plot(
      time,
      codF[, 1],
      type = "l",
      lwd = 2,
      xaxs = "i",
      yaxs = 'i',
      col = col[1],
      ylim = ylim,
      xlim = xlim,
      xlab = "",
      ylab = "",
      axes = F,
      main = case.2.use[CASE]
    )
    axis(1, at = xlim)
    axis(2, at = ylim, labels = c("", ""))
  }
  
  for (i in 2:4) {
    lines(time, codF[, i], lwd = 2, col = col[i])
  }
  # Plot herring
  ylim <- c(0, .9)
  if (CASE == 1) {
    plot(
      time,
      herrF[, 1],
      type = "l",
      lwd = 2,
      xaxs = "i",
      yaxs = 'i',
      col = col[1],
      ylim = ylim,
      xlim = xlim,
      ylab = "Prey \nFishing Rate",
      xlab = "",
      axes = F
    )
    axis(1, at = xlim)
    axis(2, at = ylim)
    mtext(
      side = 2,
      text = "Prey \nFishing Rate",
      line = 3,
      las = 0
    )
  } else {
    plot(
      time,
      herrF[, 1],
      type = "l",
      lwd = 2,
      xaxs = "i",
      yaxs = 'i',
      col = col[1],
      ylim = ylim,
      xlim = xlim,
      xlab = "",
      ylab = "",
      axes = F
    )
    axis(1, at = xlim)
    axis(2, at = ylim, labels = c("", ""))
  }
  for (i in 2:4) {
    lines(time, herrF[, i], lwd = 2, col = col[i])
  }
  # create legend
}
  setwd(wd)
}
par(xpd = TRUE)
legend(
  x= -0.25,
  y = 1.0,
  legend = c('Independent', '+Predation', '+Egg Predation', '+ Depensation'),
  col = col,
  lwd = 2,
  bty ="n",
  cex = 1.25
)

dev.off()
setwd("./graphics")
#optional code to open using Skim if installed
system2("open", args = c("-a Skim.app", plotfilename))
setwd(wd)