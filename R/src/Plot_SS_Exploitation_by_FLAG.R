# Last Modified on February 27 2017
# Extract output files (generated by M file "Data Extraction for Figures.M")
# Looks at quasi steady state exploitation rates (are these really harvest rates?) at year 15 for Pred and Prey in each of the 4 ecological scenarios FLAGS
rm(list = ls())
require("RColorBrewer")
wd <- '/Users/essing/Dropbox/Desktop/Rcode/EggPredationModel'
setwd(wd)

datadir <- 'data/optimization_output_summer_2016'

plotfilename <- "SSExploitation.pdf"

codB <- c()
codF <- c()
herrB <- c()
herrF <- c()


year.2.use <- 20
CASE = 1 # use high high, that is the simplest but all reach the same end point
setwd(paste("./",datadir,sep = ""))
# cycle through ecological scenarios (FLAG)
for (FLAG in 1:4) {
  filename = paste('output_', CASE, '_', FLAG, '.csv', sep = "")
  tmp.data <- read.csv(file = filename)
  eval(parse(text = paste("data",CASE, FLAG," <- ","tmp.data", sep = "")))
  if (CASE == 1)
    eval(parse(text = paste('time<-data', CASE, FLAG, '[,1]', sep = "")))
  eval(parse(text = paste(
    'codB<-cbind(codB,data', CASE, FLAG, '[,2])', sep = ""
  )))
  eval(parse(text = paste(
    'codF<-cbind(codF,data', CASE, FLAG, '[,4])', sep = ""
  )))
  eval(parse(
    text = paste('herrB<-cbind(herrB,data', CASE, FLAG, '[,3])', sep = "")
  ))
  eval(parse(
    text = paste('herrF<-cbind(herrF,data', CASE, FLAG, '[,5])', sep = "")
  ))
}
setwd(wd)


row.index <- which(time >= year.2.use)[1]
codFs <- codF[row.index, ]
herrFs <- herrF[row.index, ]

# Make a lil' table
plotFs <- matrix(cbind(codFs, herrFs),
                 nrow = 4,
                 ncol = 2,
                 byrow = F)
colnames(plotFs) = c("Piscivore", "Prey")
rownames(plotFs) = c("Independent", "+Predation", "+Egg Predation", "+Depensation")

# Set up plotting parameters
# 
setwd("./graphics")
pdf(file = plotfilename,
    height = 5,
    width = 8)
par(
  omi = c(.5, .5, .5, .5),
  mai = c(.75, 1.00, 0.25, 0.5),
  las = 1,
  cex.lab = 1.5,
  cex.axis = 1.0
)

col <-
  colorRampPalette(rev(brewer.pal(9, "Spectral")), interpolate = "spline")(8)


barplot(
  t(plotFs),
  beside = T,
  ylab = "Steady State Fishing Rate",
  cex.names = 1.0,
  las = 1,
  col = c("black","gray90"),
  xaxs = "i",
  yaxs = "i",
  ylim = c(0, .32)
)
abline(h = 0)

dev.off()
system2("open", args = c("-a Skim.app", plotfilename))
setwd("..")
